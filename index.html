<!DOCTYPE html>
<html>

<head>
  <meta charset=utf-8 />
  <title>Kentucky Biodiversity Project - Beta</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <!-- loading Assembly CSS here -->
  <link href='https://api.mapbox.com/mapbox-assembly/v0.20.0/assembly.min.css' rel='stylesheet'>
  <link href='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.css' rel='stylesheet' />
  <!-- <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" /> -->
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css" /> -->
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css" /> -->


  <style>
    #map {
      background: #448ee4;
    }

    h1 {
      color: orange;
    }

    .leaflet-tooltip {
      min-width: 140px;
      font-size: 140%;
      white-space: normal;
    }
  </style>


</head>

<body>

  <div class='flex-parent viewport-full relative scroll-hidden'>
    <div class='flex-child w-full w300-ml absolute static-ml left bottom'>
      <div class='flex-parent flex-parent--column viewport-third h-full hmax-full bg-white py18 px12'>
        <div class='flex-child flex-child--grow px12 py12 scroll-auto'>
          <h1 class='txt-h1 mb6'>Title here</h1>
          <p>Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Sed posuere consectetur est
            at lobortis. Aenean eu leo quam. Pellentesque ornare sem lacinia quam venenatis vestibulum. Aenean lacinia bibendum
            nulla sed consectetur. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cum sociis natoque penatibus
            et magnis dis parturient montes, nascetur ridiculus mus.</p>
          <h2 class='txt-xl mt18 mb12'>subheading</h2>
          <p>Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Sed posuere consectetur est
            at lobortis. Aenean eu leo quam. Pellentesque ornare sem lacinia quam venenatis vestibulum. Aenean lacinia bibendum
            nulla sed consectetur. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cum sociis natoque penatibus
            et magnis dis parturient montes, nascetur ridiculus mus.</p>
        </div>
        <footer class='px12 py12 bg-gray-faint txt-s'>
          <ul>
            <li>Explore the raw
              <a class='link' href='#'>data</a>
            </li>
            <li>Map authored by
              <a class='link' href='#'>Ptolemy</a>
            </li>
          </ul>
        </footer>
      </div>
    </div>
    <div class='flex-child flex-child--grow viewport-twothirds viewport-full-ml'>
      <div id="map" class='viewport-twothirds viewport-full-ml'></div>

      <!-- ui slider -->
      <div id='slider' class='range w249 bg-white round-ml px12'>
        <input type='range' />
      </div>
      <!-- legend -->
      <div id='legend' class='bg-white round-ml px18 py12'>
        <h3 class='txt-bold mb12 w-full mx-auto'>Legend Title</h3>
        <div class='bg-blue h180 w240 mx-auto'></div>
      </div>

      <div id='ui-controls'>
        <label>Choose Taxonomy:</label>
        <select id="taxonomy-selector">
          <option value="Animals" selected>Animals</option>
          <option value="Plants">+ Plants</option>
          <option value="Communities">Communities</option>
          <option value="totals">Combined</option>
        </select>
      </div>
      <!-- end ui-controls -->

    </div>
  </div>


  <!-- loading Assembly JS here -->
  <script async defer src="https://api.mapbox.com/mapbox-assembly/v0.20.0/assembly.js"></script>
  <script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
  <!-- <script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script> -->
  <!-- <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.3.1/leaflet-omnivore.min.js'></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.3.6/papaparse.min.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.5/chroma.min.js"></script>
  <script src="http://code.jquery.com/jquery-3.2.1.min.js"></script>
  <!-- <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script> -->
  <script src="https://unpkg.com/simple-statistics@5.2.1/dist/simple-statistics.min.js"></script>


  <script>
    L.mapbox.accessToken =
      'pk.eyJ1IjoiaWFuaG9ybiIsImEiOiJjamRocmdseWUxMjJ0MnlwNDdiMDd5ZXZzIn0.jBWD0r86k4pBSymNrCKfzw';
    var map = L.mapbox.map('map', 'mapbox.pirates', {
      zoomSnap: .1,
      center: [37.6438332, -85.6487252],
      zoom: 7,
      minZoom: 1,
      maxZoom: 20,
      fillOpacity: 1
      //maxBounds: L.latLngBounds([-6.22, 27.72], [5.76, 47.83])
    });

    var attributeValue = "taxonomy";

    $.getJSON("data/eoKyQuads.json", function (data) {

      drawMap(data);
    }); // end of $.getJSON()


    function drawMap(data) {

      // create Leaflet object with geometry data and add to map
      var dataLayer = L.geoJson(data, {
        style: function (feature) {
          return {
            color: 'blue',
            weight: 1,
            fillOpacity: .5,
            fillColor: '#1f78b4'
          };
        },

        onEachFeature: function (feature, layer) {

          // when mousing over a layer
          layer.on('mouseover', function () {

            // change the stroke color and bring that element to the front
            layer.setStyle({
              color: '#ff6e00'
            }).bringToFront();
          });

          // on mousing off layer
          layer.on('mouseout', function () {

            // reset the layer style to its original stroke color
            layer.setStyle({
              color: '#1f78b4'
            });
          });
        }

      }).addTo(map);



      //first set the zoom/center to the dataLayer's extent
      map.fitBounds(dataLayer.getBounds());

      // call the update function
      updateMap(dataLayer);


    } // end function drawMap

    function updateMap(dataLayer) {

      // get the class breaks for the current data attribute
      var breaks = getClassBreaks(dataLayer);

      // loop through each county layer to update the color and tooltip info
      dataLayer.eachLayer(function (layer) {

        var props = layer.feature.properties;

        // set the fill color of layer based on its normalized data value
        layer.setStyle({
          fillColor: getColor(props[attributeValue], breaks)
        });

        // assemble string sequence of info for tooltip (end line break with + operator)
        var tooltipInfo = "<b>" + "QUAD: " +  props["quad24name"];

        // bind a tooltip to layer with county-specific information
        layer.bindTooltip(tooltipInfo, {
          // sticky property so tooltip follows the mouse
          sticky: true,
          tooltipAnchor: [200, 200]
        });
      });
    }


    function getClassBreaks(dataLayer) {
      // create empty Array for storing values
      var values = [];

      // loop through all the quads
      dataLayer.eachLayer(function (layer) {
        var value = layer.feature.properties[attributeValue];
        values.push(value); // push the value for each layer into the Array

      });
      // determine similar clusters
      var clusters = ss.ckmeans(values, 5);
      // create an array of the lowest value within each cluster
      var breaks = clusters.map(function (cluster) {
        return [cluster[0], cluster.pop()];
      });
      //return array of arrays, e.g., [[0,5], [6, 10], etc]
      return breaks;
    }

    function getColor(d, breaks) {
      // function accepts a single  data attribute value
      // and uses a series of conditional statements to determine which
      // which color value to return to return to the function caller
      if (d <= breaks[0][1]) {
        return '#f1eef6';
      } else if (d <= breaks[1][1]) {
        return '#bdc9e1';
      } else if (d <= breaks[2][1]) {
        return '#74a9cf';
      } else if (d <= breaks[3][1]) {
        return '#2b8cbe'
      } else if (d <= breaks[4][1]) {
        return '#045a8d'
      }
    }
  </script>






</body>

</html>